<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificates</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@vscode/codicons@0.0.35/dist/codicon.css">
</head>

<body>
    <!-- CA Certificate Section -->
    <div class="section">
        <div class="section-header">
            <h3 class="section-title">
                <span id="ca-status-indicator" class="status-indicator status-disabled"></span>
                CA Certificate
            </h3>
            <label class="checkbox-label">
                <input type="checkbox" id="ca-enabled" onchange="toggleCaCert()">
                Enable
            </label>
        </div>

        <div class="flex gap-8 items-center">
            <input type="text" id="ca-cert-path" class="input input-readonly flex-1" readonly
                placeholder="No CA certificate selected">
            <button class="button" onclick="selectCaCertificate()">
                <span class="codicon codicon-folder"></span>
                Browse...
            </button>
        </div>

        <div class="horizontal-line-padded"></div>
        <!-- Client Certificates Section -->

        <div class="section-header">
            <h3 class="section-title">Client Certificates</h3>
            <button class="button" onclick="addClientCertificate()">
                <span class="codicon codicon-add"></span>
                Add Certificate
            </button>
        </div>

        <div id="client-certs-container" class="item-list">
            <div id="empty-state" class="empty-state">
                No client certificates configured.<br>
                Click "Add Certificate" to configure your first certificate.
            </div>
        </div>

        <div class="horizontal-line-padded"></div>
        <!-- SSL Validation Section -->

        <label class="checkbox-label">
            <input type="checkbox" id="ssl-validation" onchange="toggleSslValidation()">
            Verify SSL certificates
        </label>
    </div>

    <script>
        const vscode = acquireVsCodeApi();
        let certificates = { ca: { enabled: false, certPath: '' }, clients: [], sslValidation: true };

        window.addEventListener('message', event => {
            const message = event.data;
            if (message.type === 'updateCertificates') {
                certificates = message.data;
                updateUI();
            }
        });

        function addClientCertificate() {
            vscode.postMessage({ type: 'addClientCertificate' });
        }

        function selectCaCertificate() {
            vscode.postMessage({ type: 'selectCaCertificate' });
        }

        function toggleClientCert(id) {
            vscode.postMessage({ type: 'toggleClientCert', id });
        }

        function toggleCaCert() {
            vscode.postMessage({ type: 'toggleCaCert' });
        }

        function removeClientCert(id) {
            vscode.postMessage({ type: 'removeClientCert', id });
        }

        function editClientCert(cert) {
            vscode.postMessage({ type: 'editClientCert', cert });
        }

        function toggleSslValidation() {
            vscode.postMessage({ type: 'toggleSslValidation' });
        }

        function updateUI() {
            // Update CA certificate
            const caEnabled = document.getElementById('ca-enabled');
            const caCertPath = document.getElementById('ca-cert-path');
            const caStatusIndicator = document.getElementById('ca-status-indicator');

            caEnabled.checked = certificates.ca.enabled;
            caCertPath.value = certificates.ca.certPath ?
                `${certificates.ca.certPath.split('/').pop()}` :
                'No CA certificate selected';

            caStatusIndicator.className = `status-indicator ${certificates.ca.enabled ? 'status-enabled' : 'status-disabled'}`;

            // Update SSL validation
            document.getElementById('ssl-validation').checked = certificates.sslValidation;

            // Update client certificates
            const container = document.getElementById('client-certs-container');
            const emptyState = document.getElementById('empty-state');

            if (certificates.clients.length === 0) {
                emptyState.style.display = 'block';
                // Remove all cert items
                const certItems = container.querySelectorAll('.item');
                certItems.forEach(item => item.remove());
            } else {
                emptyState.style.display = 'none';

                // Clear existing items
                const certItems = container.querySelectorAll('.item');
                certItems.forEach(item => item.remove());

                // Add client certificates
                certificates.clients.forEach(cert => {
                    const certDiv = document.createElement('div');
                    certDiv.className = 'item fade-in';
                    certDiv.innerHTML = `
                        <div class="item-info">
                            <div class="item-title">
                                <span class="status-indicator ${cert.enabled ? 'status-enabled' : 'status-disabled'}"></span>
                                ${cert.name}
                            </div>
                            <div class="item-details">${cert.host} â€¢ ${cert.certPath.split('/').pop()}</div>
                        </div>
                        <div class="item-actions">
                            <label class="checkbox-label">
                                <input type="checkbox" ${cert.enabled ? 'checked' : ''} 
                                       onchange="toggleClientCert('${cert.id}')">
                                Enabled
                            </label>
                            <div class="button-group">
                                <button class="button button-secondary button-small" 
                                        onclick="editClientCert(${JSON.stringify(cert).replace(/"/g, '&quot;')})">
                                    <span class="codicon codicon-edit"></span>
                                </button>
                                <button class="button button-secondary button-small" 
                                        onclick="removeClientCert('${cert.id}')">
                                    <span class="codicon codicon-trash"></span>
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(certDiv);
                });
            }
        }

        // Initial refresh
        vscode.postMessage({ type: 'refresh' });
    </script>
</body>

</html>