<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@vscode/codicons@0.0.35/dist/codicon.css">
</head>

<body>
  <div class="section">
    <div class="mb-12">
      <label class="label" for="serverType">Server Type</label>
      <select id="serverType" class="input" ${disabled}>
        <option value="http" ${serverType==='http' ? 'selected' : '' }>HTTP</option>
        <option value="ws" ${serverType==='ws' ? 'selected' : '' }>WebSocket</option>
      </select>
    </div>

    <div class="flex gap-8 mb-12">
      <div class="flex-1">
        <label class="label" for="port">Port</label>
        <input id="port" class="input" type="number" min="1" max="65535" value="${port}" ${disabled} />
      </div>
      <div class="flex-1">
        <label class="label" for="statusCode">HTTP Status Code</label>
        <input id="statusCode" class="input" type="number" min="100" max="599" value="${statusCode}" />
      </div>
    </div>

    <div class="mb-12">
      <label class="label" for="reflect">Reflect request as response</label>
      <input id="reflect" type="checkbox" ${reflect ? 'checked' : ''} />
    </div>

    <div class="mb-12">
      <label class="label" for="response">Response</label>
      <textarea id="response" class="textarea" ${reflect ? 'disabled' : ''}>${response}</textarea>
    </div>

    <button id="runBtn" class="button">
      <span class="codicon codicon-play"></span>
      ${buttonText}
    </button>
  </div>

  <script>
    const vscode = acquireVsCodeApi();

    document.querySelector('#serverType').onchange = e => {
      vscode.postMessage({ type: 'setType', value: e.target.value });
    };

    document.querySelector('#port').onchange = e => {
      vscode.postMessage({ type: 'setPort', value: e.target.value });
    };

    document.getElementById('statusCode').onchange = e => {
      vscode.postMessage({ type: 'setStatusCode', value: e.target.value });
    };

    document.querySelector('#reflect').onchange = e => {
      vscode.postMessage({ type: 'setReflect', value: e.target.checked });
      // Disable/enable response textarea based on reflect
      document.getElementById('response').disabled = e.target.checked;
    };

    document.querySelector('#response').oninput = e => {
      vscode.postMessage({ type: 'setResponse', value: e.target.value });
    };

    document.querySelector('#runBtn').onclick = () => {
      const runBtn = document.getElementById('runBtn');
      const iconSpan = runBtn.querySelector('.codicon');

      if (runBtn.textContent.includes('Run') || runBtn.textContent.includes('Start')) {
        vscode.postMessage({ type: 'startServer' });
        iconSpan.className = 'codicon codicon-debug-stop';
        runBtn.innerHTML = `<span class="codicon codicon-debug-stop"></span> Stop localhost:${document.getElementById('port').value}`;
      } else {
        vscode.postMessage({ type: 'stopServer' });
        iconSpan.className = 'codicon codicon-play';
        runBtn.innerHTML = `<span class="codicon codicon-play"></span> Run Mock Server`;
      }
    };
  </script>
</body>

</html>